(()=>{"use strict";const e=this||window,t=new Map,o=new Map,r=new Map,n=["Date","Blob","Number","String","Boolean","Error","SyntaxError","TypeError","URIError","Function","Promise","RegExp"];function l(e){return n.indexOf(e.constructor.name)>=0}function i(e,n){let l,i=o.get(e),f=r.get(i.root);return l="pop"===n?function(){let r,l,a;return r=e.length-1,l=Reflect.apply(e[n],e,arguments),(a=t.get(l))&&o.get(a).revoke(),f.notify([new y(i.path.concat(r),a||l)]),a||l}:"push"===n?function(){let t,o,r,l=[];t=Array.from(arguments),r=e.length;for(let e,o=0,n=t.length;o<n;o++)(e=t[o])&&"object"==typeof e&&(t[o]=new c(e,r+o,i).proxy),l.push(new s(i.path.concat(r+o),e));return o=Reflect.apply(e[n],e,t),f.notify(l),o}:"shift"===n?function(){let r,l;r=Reflect.apply(e[n],e,arguments),(l=t.get(r))&&o.get(l).revoke();for(let r,n,l=0,i=e.length;l<i;l++)(r=e[l])&&"object"==typeof r&&((n=o.get(t.get(r)))?n.ownKey=l:console.error("unexpectedly failed to resolve proxy -> target -> observed"));return f.notify([new y(i.path.concat(0),l||r)]),l||r}:"unshift"===n?function(){let r,l,a,p=[];(r=Array.from(arguments)).forEach(function(e,t){e&&"object"==typeof e&&(r[t]=new c(e,t,i).proxy)}),l=Reflect.apply(e[n],e,r);for(let r,n=0,l=e.length;n<l;n++)(r=e[n])&&"object"==typeof r&&((a=o.get(t.get(r)))?a.ownKey=n:console.error("failed to resolve proxy -> target -> observed"));for(let t=0,o=r.length;t<o;t++)p.push(new s(i.path.concat(t),e[t]));return f.notify(p),l}:"reverse"===n?function(){let r;Reflect.apply(e[n],e,arguments);for(let n,l=0,i=e.length;l<i;l++)(n=e[l])&&"object"==typeof n&&((r=o.get(t.get(n)))?r.ownKey=l:console.error("failed to resolve proxy -> target -> observed"));return f.notify([new function(){Object.defineProperties(this,{type:{value:"reverse"}})}]),this}:"sort"===n?function(){let r;Reflect.apply(e[n],e,arguments);for(let n,l=0,i=e.length;l<i;l++)(n=e[l])&&"object"==typeof n&&((r=o.get(t.get(n)))?r.ownKey=l:console.error("failed to resolve proxy -> target -> observed"));return f.notify([new function(){Object.defineProperties(this,{type:{value:"shuffle"}})}]),this}:"fill"===n?function(){let r,l,a,p=[],y=arguments.length,h=e.length;r=y<2?0:arguments[1]<0?h+arguments[1]:arguments[1],l=y<3?h:arguments[2]<0?h+arguments[2]:arguments[2],a=e.slice(),Reflect.apply(e[n],e,arguments);for(let n,f,y=r;y<l;y++)(n=e[y])&&"object"==typeof n&&(e[y]=new c(n,y,i).proxy),a.hasOwnProperty(y)?((f=t.get(a[y]))&&o.get(f).revoke(),p.push(new u(i.path.concat(y),e[y],f||a[y]))):p.push(new s(i.path.concat(y),e[y]));return f.notify(p),this}:"splice"===n?function(){let r,l,a,p,h,b,v,g,w=[],d=e.length;v=(r=Array.from(arguments)).length;for(let e,t=0;t<v;t++)e=r[t],t>1&&e&&"object"==typeof e&&(r[t]=new c(e,t,i).proxy);p=0===v?0:r[0]<0?d+r[0]:r[0],h=v<2?d-p:r[1],b=Math.max(v-2,0),l=Reflect.apply(e[n],e,r);for(let r,n=0;n<d;n++)(r=e[n])&&"object"==typeof r&&((a=o.get(t.get(r)))?a.ownKey=n:console.error("failed to resolve proxy -> target -> observed"));for(let e,r,n=0,i=l.length;n<i;n++)e=l[n],(r=t.get(e))&&(o.get(r).revoke(),l[n]=r);for(g=0;g<h;g++)g<b?w.push(new u(i.path.concat(p+g),e[p+g],l[g])):w.push(new y(i.path.concat(p+g),l[g]));for(;g<b;g++)w.push(new s(i.path.concat(p+g),e[p+g]));return f.notify(w),l}:Reflect.get(e,n)}function f(e,n,i){let f,a,p=e.hasOwnProperty(n),y=e[n],h=o.get(e),b=r.get(h.root);if((f=i&&"object"==typeof i&&!l(i)?Reflect.set(e,n,new c(i,n,h).proxy):Reflect.set(e,n,i))&&((a=t.get(y))&&o.get(a).revoke(),b.hasListeners()&&!h.preventCallbacks)){let e=h.path.concat(n);b.notify([p?new u(e,i,a||y):new s(e,i)])}return f}function a(e,n){let l,i,f=e[n],a=o.get(e),c=r.get(a.root);if((l=Reflect.deleteProperty(e,n))&&((i=t.get(f))&&o.get(i).revoke(),c.hasListeners()&&!a.preventCallbacks)){let e=a.path.concat(n);c.notify([new y(e,i||f)])}return l}function c(e,r,n){let p,s,u;if(!e||"object"!=typeof e)throw new Error("Observed MUST be created from a non null object origin");if(n&&(void 0===r||null===r))throw new Error("any non-root (parent-less) Observed MUST have an own path; now parent is "+n+"; key is "+r);if(n&&!(n instanceof c))throw new Error("parent, when supplied, MUST be an instance of Observed");var y;y=e,p=Array.isArray(y)?y.slice():Object.assign({},y),Array.isArray(p)?(!function(e,t){for(let o,r=0,n=e.length;r<n;r++)(o=e[r])&&"object"==typeof o&&!l(o)&&(e[r]=new c(o,r,t).proxy)}(p,this),s=Proxy.revocable(p,{set:f,get:i,deleteProperty:a})):(!function(e,t){let o=Object.keys(e);for(let r,n,i=0,f=o.length;i<f;i++)(n=e[r=o[i]])&&"object"==typeof n&&!l(n)&&(e[r]=new c(n,r,t).proxy)}(p,this),s=Proxy.revocable(p,{set:f,deleteProperty:a})),u=s.proxy,o.set(p,this),t.set(u,p),Object.defineProperties(this,{revokable:{value:s},proxy:{value:u},parent:{value:n},ownKey:{value:r,writable:!0}})}function p(e){let t=!1,o=[];Object.defineProperties(e.proxy,{observe:{value:function(e){if(t)throw new TypeError("revoked Observable MAY NOT be observed anymore");if("function"!=typeof e)throw new Error("observer (callback) parameter MUST be a function");o.indexOf(e)<0?o.push(e):console.info("observer (callback) may be bound to an observable only once")}},unobserve:{value:function(){if(t)throw new TypeError("revoked Observable MAY NOT be unobserved anymore");if(arguments.length)for(let e,t=0,r=arguments.length;t<r;t++)(e=o.indexOf(arguments[t]))>=0&&o.splice(e,1);else o.splice(0,o.length)}},revoke:{value:function(){t?console.log("revoking of Observable effective only once"):(t=!0,e.revoke())}}}),Object.defineProperties(this,{hasListeners:{value:function(){return o.length>0}},notify:{value:function(e){for(let t,r=0,n=o.length;r<n;r++){t=o[r];try{t(e)}catch(e){console.error("one/some of the observing callbacks failed with ",e)}}}}})}function s(e,t){Object.defineProperties(this,{type:{value:"insert"},path:{value:e},value:{value:t}})}function u(e,t,o){Object.defineProperties(this,{type:{value:"update"},path:{value:e},value:{value:t},oldValue:{value:o}})}function y(e,t){Object.defineProperties(this,{type:{value:"delete"},path:{value:e},oldValue:{value:t}})}Object.defineProperty(c.prototype,"root",{get:function(){let e=this;for(;e.parent;)e=e.parent;return e}}),Object.defineProperty(c.prototype,"path",{get:function(){let e=[],t=this;for(;void 0!==t.ownKey;)e.unshift(t.ownKey),t=t.parent;return e}}),Object.defineProperty(c.prototype,"revoke",{value:function(){let e=t.get(this.proxy),r=Object.keys(e);this.revokable.revoke();for(let n,l,i=0,f=r.length;i<f;i++)n=r[i],(l=t.get(e[n]))&&(e[n]=o.get(l).revoke());return t.delete(this.proxy),o.delete(e),e}}),Object.defineProperty(p,"from",{value:function(e){if(!e||"object"!=typeof e)throw new Error("observable MAY ONLY be created from non-null object only");if("observe"in e||"unobserve"in e||"revoke"in e)throw new Error('target object MUST NOT have nor own neither inherited properties from the following list: "observe", "unobserve", "revoke"');if(l(e))throw new Error(e+" found to be one of non-observable object types: "+n);let t=new c(e),o=new p(t);return r.set(t,o),t.proxy}}),Object.defineProperty(e,"Observable",{value:p})})();