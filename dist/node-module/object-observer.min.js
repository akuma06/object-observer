const e=new WeakMap,t={Date:!0,Blob:!0,Number:!0,String:!0,Boolean:!0,Error:!0,SyntaxError:!0,TypeError:!0,URIError:!0,Function:!0,Promise:!0,RegExp:!0};class r extends Array{constructor(e,r){super(e.length);let o,s=e.length;for(;s--;)(o=e[s])&&"object"==typeof o&&!t.hasOwnProperty(o.constructor.name)?this[s]=new n({target:o,ownKey:s,parent:r}).proxy:this[s]=o}revoke(){e.get(this).revoke()}observe(t){e.get(this).observe(t)}unobserve(){let t=e.get(this);t.unobserve.apply(t,arguments)}}class o{constructor(e,r){let o,s,l=Object.getOwnPropertyNames(e),i=l.length;for(;i--;)(s=e[o=l[i]])&&"object"==typeof s&&!t.hasOwnProperty(s.constructor.name)?this[o]=new n({target:s,ownKey:o,parent:r}).proxy:this[o]=s}revoke(){e.get(this).revoke()}observe(t){e.get(this).observe(t)}unobserve(){let t=e.get(this);t.unobserve.apply(t,arguments)}}function n(t){this.parent=t.parent,this.ownKey=t.ownKey;let n,s=t.target;Array.isArray(s)?(n=new r(s,this),this.revokable=Proxy.revocable(n,{deleteProperty:this.proxiedDelete.bind(this),set:this.proxiedSet.bind(this),get:this.proxiedArrayGet.bind(this)})):(n=new o(s,this),this.revokable=Proxy.revocable(n,{deleteProperty:this.proxiedDelete.bind(this),set:this.proxiedSet.bind(this)})),null===this.parent&&(this.isRevoked=!1,this.callbacks=[],this.observe=function(e){if(this.isRevoked)throw new TypeError("revoked Observable MAY NOT be observed anymore");if("function"!=typeof e)throw new Error("observer (callback) parameter MUST be a function");this.callbacks.indexOf(e)<0?this.callbacks.push(e):console.info("observer (callback) may be bound to an observable only once")},this.unobserve=function(){if(this.isRevoked)throw new TypeError("revoked Observable MAY NOT be unobserved anymore");let e=arguments.length;if(e)for(;e--;){let t=this.callbacks.indexOf(arguments[e]);t>=0&&this.callbacks.splice(t,1)}else this.callbacks.splice(0)}),this.target=n,this.proxy=this.revokable.proxy,e.set(this.proxy,this)}n.prototype.getPath=function(){let e=[],t=[],r=0,o=0,n=this;for(;null!==n.ownKey;)e[r++]=n.ownKey,n=n.parent;for(;r--;)t[o++]=e[r];return t},n.prototype.getListeners=function(){let e=this;for(;e.parent;)e=e.parent;return e.callbacks},n.prototype.callListeners=function(e,t){let r=e.length;for(;r--;)try{e[r](t)}catch(e){console.error(e)}},n.prototype.revoke=function(){let t,r,o,n=this.target,s=Object.keys(n),l=s.length;for(this.revokable.revoke();l--;)(r=n[t=s[l]])&&"object"==typeof r&&(o=e.get(r))&&(n[t]=o.revoke());return e.delete(this.proxy),n},n.prototype.proxiedSet=function(r,o,s){let l=r[o];if(s&&"object"==typeof s&&!t.hasOwnProperty(s.constructor.name)?r[o]=new n({target:s,ownKey:o,parent:this}).proxy:r[o]=s,l&&"object"==typeof l){let t=e.get(l);t&&(t.revoke(),l=t.target)}let i=this.getListeners();if(i.length){let e=this.getPath();e.push(o),this.callListeners(i,void 0!==l?[{type:"update",path:e,value:s,oldValue:l}]:[{type:"insert",path:e,value:s}])}return!0},n.prototype.proxiedArrayGet=function(r,o){const s={pop:function(t,r){let o,n,s;o=t.length-1,(n=t.pop())&&"object"==typeof n&&(s=e.get(n))&&(s.revoke(),n=s.target);let l=r.getListeners();if(l.length){let e=r.getPath();e.push(o),r.callListeners(l,[{type:"delete",path:e,oldValue:n}])}return n},push:function(e,r){let o,s,l,i=arguments.length-2,a=new Array(i),p=[],h=r.getListeners();s=e.length,h.length&&(l=r.getPath());for(let e,o=0;o<i;o++)(e=arguments[o+2])&&"object"==typeof e&&!t.hasOwnProperty(e.constructor.name)&&(e=new n({target:e,ownKey:s+o,parent:r}).proxy),a[o]=e;if(o=Reflect.apply(e.push,e,a),h.length){for(let t=s,r=e.length;t<r;t++){let r=l.slice(0);r.push(t),p[t-s]={type:"insert",path:r,value:e[t]}}r.callListeners(h,p)}return o},shift:function(t,r){let o,n,s=r.getListeners();(o=t.shift())&&"object"==typeof o&&(n=e.get(o))&&(n.revoke(),o=n.target);for(let r,o,n=0,s=t.length;n<s;n++)(r=t[n])&&"object"==typeof r&&((o=e.get(r))?o.ownKey=n:console.error("unexpectedly failed to resolve proxy -> observed"));if(s.length){let e=r.getPath();e.push(0),r.callListeners(s,[{type:"delete",path:e,oldValue:o}])}return o},unshift:function(r,o){let s,l,i,a=o.getListeners(),p=[];(s=Array.from(arguments)).splice(0,2),s.forEach((e,r)=>{e&&"object"==typeof e&&!t.hasOwnProperty(e.constructor.name)&&(s[r]=new n({target:e,ownKey:r,parent:o}).proxy)}),l=Reflect.apply(r.unshift,r,s);for(let t,o=0,n=r.length;o<n;o++)(t=r[o])&&"object"==typeof t&&((i=e.get(t))?i.ownKey=o:console.error("failed to resolve proxy -> observed"));if(a.length){let e,t=o.getPath();for(let o=0,n=s.length;o<n;o++)(e=t.slice(0)).push(o),p.push({type:"insert",path:e,value:r[o]});o.callListeners(a,p)}return l},reverse:function(t,r){let o,n=r.getListeners();t.reverse();for(let r,n=0,s=t.length;n<s;n++)(r=t[n])&&"object"==typeof r&&((o=e.get(r))?o.ownKey=n:console.error("failed to resolve proxy -> observed"));return n.length&&r.callListeners(n,[{type:"reverse",path:r.getPath()}]),r.proxy},sort:function(t,r,o){let n,s=r.getListeners();t.sort(o);for(let r,o=0,s=t.length;o<s;o++)(r=t[o])&&"object"==typeof r&&((n=e.get(r))?n.ownKey=o:console.error("failed to resolve proxy -> observed"));return s.length&&r.callListeners(s,[{type:"shuffle",path:r.getPath()}]),r.proxy},fill:function(r,o){let s,l,i,a,p,h,c,y=o.getListeners(),f=[],u=r.length;(s=Array.from(arguments)).splice(0,2),i=(l=s.length)<2?0:s[1]<0?u+s[1]:s[1],a=l<3?u:s[2]<0?u+s[2]:s[2],p=r.slice(0),Reflect.apply(r.fill,r,s),y.length&&(h=o.getPath());for(let s,l,y,u=i;u<a;u++)(s=r[u])&&"object"==typeof s&&!t.hasOwnProperty(s.constructor.name)&&(r[u]=new n({target:s,ownKey:u,parent:o}).proxy),p.hasOwnProperty(u)?((y=p[u])&&"object"==typeof y&&(l=e.get(y))&&(l.revoke(),y=l.target),(c=h.slice(0)).push(u),f.push({type:"update",path:c,value:r[u],oldValue:y})):((c=h.slice(0)).push(u),f.push({type:"insert",path:c,value:r[u]}));return y.length&&o.callListeners(y,f),o.proxy},splice:function(r,o){let s,l,i,a,p,h,c,y=o.getListeners(),f=[],u=r.length;(s=Array.from(arguments)).splice(0,2),c=s.length;for(let e,r=2;r<c;r++)(e=s[r])&&"object"==typeof e&&!t.hasOwnProperty(e.constructor.name)&&(s[r]=new n({target:e,ownKey:r,parent:o}).proxy);a=0===c?0:s[0]<0?u+s[0]:s[0],p=c<2?u-a:s[1],h=Math.max(c-2,0),l=Reflect.apply(r.splice,r,s),u=r.length;for(let t,o=0;o<u;o++)(t=r[o])&&"object"==typeof t&&((i=e.get(t))?i.ownKey=o:console.error("failed to resolve proxy -> target -> observed"));for(let t,r,o=0,n=l.length;o<n;o++)(t=l[o])&&"object"==typeof t&&(r=e.get(t))&&(r.revoke(),l[o]=r.target);if(y.length){let e,t,n=o.getPath();for(e=0;e<p;e++)(t=n.slice(0)).push(a+e),e<h?f.push({type:"update",path:t,value:r[a+e],oldValue:l[e]}):f.push({type:"delete",path:t,oldValue:l[e]});for(;e<h;e++)(t=n.slice(0)).push(a+e),f.push({type:"insert",path:t,value:r[a+e]});o.callListeners(y,f)}return l}};return s.hasOwnProperty(o)?s[o].bind(void 0,r,this):r[o]},n.prototype.proxiedDelete=function(t,r){let o=t[r];if(delete t[r]){if(o&&"object"==typeof o){let t=e.get(o);t&&(t.revoke(),o=t.target)}let t=this.getListeners();if(t.length){let e=this.getPath();e.push(r),this.callListeners(t,[{type:"delete",path:e,oldValue:o}])}return!0}return!1};class s{static from(e){if(!(!e||"object"!=typeof e||t.hasOwnProperty(e.constructor.name)||"observe"in e||"unobserve"in e||"revoke"in e)){return new n({target:e,ownKey:null,parent:null}).proxy}if(!e||"object"!=typeof e)throw new Error("observable MAY ONLY be created from non-null object only");if("observe"in e||"unobserve"in e||"revoke"in e)throw new Error('target object MUST NOT have nor own neither inherited properties from the following list: "observe", "unobserve", "revoke"');if(t.hasOwnProperty(e.constructor.name))throw new Error(e+" found to be one of non-observable object types: "+t)}}Object.freeze(s),module.exports=s;