const e=new WeakMap,t=new WeakMap,r={Date:!0,Blob:!0,Number:!0,String:!0,Boolean:!0,Error:!0,SyntaxError:!0,TypeError:!0,URIError:!0,Function:!0,Promise:!0,RegExp:!0},o={pop:function(r){let o,n,l,a=e.get(r),i=a.getListeners();if(o=r.length-1,n=Reflect.apply(r.pop,r,arguments),(l=t.get(n))&&(l.revoke(),n=l.target),i.length){let e=a.getPath();e.push(o),s(i,[{type:"delete",path:e,oldValue:n}])}return n},push:function(t){let r,o,l,a=e.get(t),i=a.getListeners(),p=arguments.length-1,c=new Array(p),f=[];o=t.length,i.length&&(l=a.getPath());for(let e,t=0;t<p;t++)if(n(e=arguments[t+1])&&(e=new h({target:e,ownKey:o+t,parent:a}).proxy),c[t]=e,i.length){let r=l.slice(0);r.push(o+t),f[t]={type:"insert",path:r,value:e}}return r=Reflect.apply(t.push,t,c),i.length&&s(i,f),r},shift:function(r){let o,n,l=e.get(r),a=l.getListeners();o=Reflect.apply(r.shift,r,arguments),(n=t.get(o))&&(n.revoke(),o=n.target);for(let e,o,n=0,l=r.length;n<l;n++)(e=r[n])&&"object"==typeof e&&((o=t.get(e))?o.ownKey=n:console.error("unexpectedly failed to resolve proxy -> observed"));if(a.length){let e=l.getPath();e.push(0),s(a,[{type:"delete",path:e,oldValue:o}])}return o},unshift:function(r){let o,l,a,i=e.get(r),p=i.getListeners(),c=[];(o=Array.from(arguments)).shift(),o.forEach((e,t)=>{n(e)&&(o[t]=new h({target:e,ownKey:t,parent:i}).proxy)}),l=Reflect.apply(r.unshift,r,o);for(let e,o=0,n=r.length;o<n;o++)(e=r[o])&&"object"==typeof e&&((a=t.get(e))?a.ownKey=o:console.error("failed to resolve proxy -> observed"));if(p.length){let e,t=i.getPath();for(let n=0,l=o.length;n<l;n++)(e=t.slice(0)).push(n),c.push({type:"insert",path:e,value:r[n]});s(p,c)}return l},reverse:function(r){let o,n=e.get(r),l=n.getListeners();r.reverse();for(let e,n=0,l=r.length;n<l;n++)(e=r[n])&&"object"==typeof e&&((o=t.get(e))?o.ownKey=n:console.error("failed to resolve proxy -> observed"));return l.length&&s(l,[{type:"reverse"}]),n.proxy},sort:function(r){let o,n=e.get(r),l=n.getListeners();Reflect.apply(r.sort,r,[arguments[1]]);for(let e,n=0,l=r.length;n<l;n++)(e=r[n])&&"object"==typeof e&&((o=t.get(e))?o.ownKey=n:console.error("failed to resolve proxy -> observed"));return l.length&&s(l,[{type:"shuffle"}]),n.proxy},fill:function(r){let o,l,a,i,p,c,f,g=e.get(r),u=g.getListeners(),y=[],b=r.length;(o=Array.from(arguments)).shift(),a=(l=o.length)<2?0:o[1]<0?b+o[1]:o[1],i=l<3?b:o[2]<0?b+o[2]:o[2],p=r.slice(0),Reflect.apply(r.fill,r,o),u.length&&(c=g.getPath());for(let e,o,l,s=a;s<i;s++)n(e=r[s])&&(r[s]=new h({target:e,ownKey:s,parent:g}).proxy),p.hasOwnProperty(s)?(l=p[s],(o=t.get(l))&&(o.revoke(),l=o.target),(f=c.slice(0)).push(s),y.push({type:"update",path:f,value:r[s],oldValue:l})):((f=c.slice(0)).push(s),y.push({type:"insert",path:f,value:r[s]}));return u.length&&s(u,y),g.proxy},splice:function(r){let o,l,a,i,p,c,f,g=e.get(r),u=g.getListeners(),y=[],b=r.length;(o=Array.from(arguments)).shift(),f=o.length;for(let e,t=0;t<f;t++)e=o[t],t>1&&n(e)&&(o[t]=new h({target:e,ownKey:t,parent:g}).proxy);i=0===f?0:o[0]<0?b+o[0]:o[0],p=f<2?b-i:o[1],c=Math.max(f-2,0),l=Reflect.apply(r.splice,r,o),b=r.length;for(let e,o=0;o<b;o++)(e=r[o])&&"object"==typeof e&&((a=t.get(e))?a.ownKey=o:console.error("failed to resolve proxy -> target -> observed"));for(let e,r,o=0,n=l.length;o<n;o++)e=l[o],(r=t.get(e))&&(r.revoke(),l[o]=r.target);if(u.length){let e,t,o=g.getPath();for(e=0;e<p;e++)(t=o.slice(0)).push(i+e),e<c?y.push({type:"update",path:t,value:r[i+e],oldValue:l[e]}):y.push({type:"delete",path:t,oldValue:l[e]});for(;e<c;e++)(t=o.slice(0)).push(i+e),y.push({type:"insert",path:t,value:r[i+e]});s(u,y)}return l}};function n(e){return e&&"object"==typeof e&&!r.hasOwnProperty(e.constructor.name)}function l(e,t){return o.hasOwnProperty(t)?o[t].bind(void 0,e):e[t]}function s(e,t){let r=e.length;for(;r--;)try{e[r](t)}catch(e){console.error(e)}}const a=e=>(class extends e{revoke(){t.get(this).revoke()}observe(e){t.get(this).observe(e)}unobserve(){let e=t.get(this);e.unobserve.apply(e,arguments)}});class i extends(a(Array)){constructor(e,t){super(e.length);let r,o=e.length;for(;o--;)n(r=e[o])?this[o]=new h({target:r,ownKey:o,parent:t}).proxy:this[o]=r}}class p extends(a(Object)){constructor(e,t){super();let r,o,l=Object.getOwnPropertyNames(e),s=l.length;for(;s--;)n(o=e[r=l[s]])?this[r]=new h({target:o,ownKey:r,parent:t}).proxy:this[r]=e[r]}}function h(r){this.parent=r.parent,this.ownKey=r.ownKey;let o,n=r.target;Array.isArray(n)?(o=new i(n,this),this.revokable=Proxy.revocable(o,{set:this.proxiedSet,get:l,deleteProperty:this.proxiedDelete})):(o=new p(n,this),this.revokable=Proxy.revocable(o,{set:this.proxiedSet,deleteProperty:this.proxiedDelete})),null===this.parent&&(this.isRevoked=!1,this.callbacks=[],this.observe=function(e){if(this.isRevoked)throw new TypeError("revoked Observable MAY NOT be observed anymore");if("function"!=typeof e)throw new Error("observer (callback) parameter MUST be a function");this.callbacks.indexOf(e)<0?this.callbacks.push(e):console.info("observer (callback) may be bound to an observable only once")},this.unobserve=function(){if(this.isRevoked)throw new TypeError("revoked Observable MAY NOT be unobserved anymore");let e=arguments.length;if(e)for(;e--;){let t=this.callbacks.indexOf(arguments[e]);t>=0&&this.callbacks.splice(t,1)}else this.callbacks.splice(0)}),this.target=o,this.proxy=this.revokable.proxy,e.set(o,this),t.set(this.proxy,this)}h.prototype.revoke=function(){let r=this.target,o=Object.keys(r),n=o.length;for(this.revokable.revoke();n--;){let e=o[n],l=t.get(r[e]);l&&(r[e]=l.revoke())}return e.delete(r),t.delete(this.proxy),r},h.prototype.getPath=function(){let e=[],t=[],r=0,o=0,n=this;for(;null!==n.ownKey;)e[r++]=n.ownKey,n=n.parent;for(;r--;)t[o++]=e[r];return t},h.prototype.getListeners=function(){let e=this;for(;e;){if(e.callbacks)return e.callbacks;e=e.parent}return[]},h.prototype.proxiedSet=function(r,o,l){let s=e.get(r),a=s.getListeners(),i=r[o];if(n(l)?r[o]=new h({target:l,ownKey:o,parent:s}).proxy:r[o]=l,i){let e=t.get(i);e&&(e.revoke(),i=e.target)}if(a.length){let e=s.getPath();e.push(o),s.callListeners(a,void 0!==i?[{type:"update",path:e,value:l,oldValue:i}]:[{type:"insert",path:e,value:l}])}return!0},h.prototype.proxiedDelete=function(r,o){let n=e.get(r),l=n.getListeners(),s=r[o];if(delete r[o]){if(s){let e=t.get(s);e&&(e.revoke(),s=e.target)}if(l.length){let e=n.getPath();e.push(o),n.callListeners(l,[{type:"delete",path:e,oldValue:s}])}return!0}return!1},h.prototype.callListeners=function(e,t){let r=e.length;for(;r--;)try{e[r](t)}catch(e){console.error(e)}};class c{static from(e){if(!(!n(e)||"observe"in e||"unobserve"in e||"revoke"in e)){return new h({target:e,ownKey:null,parent:null}).proxy}if(!e||"object"!=typeof e)throw new Error("observable MAY ONLY be created from non-null object only");if("observe"in e||"unobserve"in e||"revoke"in e)throw new Error('target object MUST NOT have nor own neither inherited properties from the following list: "observe", "unobserve", "revoke"');if(!n(e))throw new Error(e+" found to be one of non-observable object types: "+r)}}Object.freeze(c);export default c;