const e=new WeakMap,t=new WeakMap,r={Date:!0,Blob:!0,Number:!0,String:!0,Boolean:!0,Error:!0,SyntaxError:!0,TypeError:!0,URIError:!0,Function:!0,Promise:!0,RegExp:!0},o={pop:function(r){let o,n,l,s=t.get(r),p=s.getListeners();if(o=r.length-1,n=Reflect.apply(r.pop,r,arguments),(l=e.get(n))&&(t.get(l).revoke(),n=l),p.length){let e=s.getPath();e.push(o),i(p,[{type:"delete",path:e,oldValue:n}])}return n},push:function(e){let r,o,l,s=t.get(e),a=s.getListeners(),h=arguments.length-1,f=new Array(h),g=[];o=e.length,a.length&&(l=s.getPath());for(let e,t=0;t<h;t++)if(n(e=arguments[t+1])&&(e=new p({target:e,ownKey:o+t,parent:s}).proxy),f[t]=e,a.length){let r=l.slice(0);r.push(o+t),g[t]={type:"insert",path:r,value:e}}return r=Reflect.apply(e.push,e,f),a.length&&i(a,g),r},shift:function(r){let o,n,l=t.get(r),s=l.getListeners();o=Reflect.apply(r.shift,r,arguments),(n=e.get(o))&&(t.get(n).revoke(),o=n);for(let o,n,l=0,s=r.length;l<s;l++)(o=r[l])&&"object"==typeof o&&((n=t.get(e.get(o)))?n.ownKey=l:console.error("unexpectedly failed to resolve proxy -> target -> observed"));if(s.length){let e=l.getPath();e.push(0),i(s,[{type:"delete",path:e,oldValue:o}])}return o},unshift:function(r){let o,l,s,a=t.get(r),h=a.getListeners(),f=[];(o=Array.from(arguments)).shift(),o.forEach((e,t)=>{n(e)&&(o[t]=new p({target:e,ownKey:t,parent:a}).proxy)}),l=Reflect.apply(r.unshift,r,o);for(let o,n=0,l=r.length;n<l;n++)(o=r[n])&&"object"==typeof o&&((s=t.get(e.get(o)))?s.ownKey=n:console.error("failed to resolve proxy -> target -> observed"));if(h.length){let e,t=a.getPath();for(let n=0,l=o.length;n<l;n++)(e=t.slice(0)).push(n),f.push({type:"insert",path:e,value:r[n]});i(h,f)}return l},reverse:function(r){let o,n=t.get(r),l=n.getListeners();r.reverse();for(let n,l=0,s=r.length;l<s;l++)(n=r[l])&&"object"==typeof n&&((o=t.get(e.get(n)))?o.ownKey=l:console.error("failed to resolve proxy -> target -> observed"));return l.length&&i(l,[{type:"reverse"}]),n.proxy},sort:function(r){let o,n=t.get(r),l=n.getListeners();Reflect.apply(r.sort,r,[arguments[1]]);for(let n,l=0,s=r.length;l<s;l++)(n=r[l])&&"object"==typeof n&&((o=t.get(e.get(n)))?o.ownKey=l:console.error("failed to resolve proxy -> target -> observed"));return l.length&&i(l,[{type:"shuffle"}]),n.proxy},fill:function(r){let o,l,s,a,h,f,g,u=t.get(r),y=u.getListeners(),c=[],b=r.length;(o=Array.from(arguments)).shift(),s=(l=o.length)<2?0:o[1]<0?b+o[1]:o[1],a=l<3?b:o[2]<0?b+o[2]:o[2],h=r.slice(0),Reflect.apply(r.fill,r,o),y.length&&(f=u.getPath());for(let o,l,i=s;i<a;i++)n(o=r[i])&&(r[i]=new p({target:o,ownKey:i,parent:u}).proxy),h.hasOwnProperty(i)?((l=e.get(h[i]))&&t.get(l).revoke(),(g=f.slice(0)).push(i),c.push({type:"update",path:g,value:r[i],oldValue:l||h[i]})):((g=f.slice(0)).push(i),c.push({type:"insert",path:g,value:r[i]}));return y.length&&i(y,c),u.proxy},splice:function(r){let o,l,s,a,h,f,g,u=t.get(r),y=u.getListeners(),c=[],b=r.length;(o=Array.from(arguments)).shift(),g=o.length;for(let e,t=0;t<g;t++)e=o[t],t>1&&n(e)&&(o[t]=new p({target:e,ownKey:t,parent:u}).proxy);a=0===g?0:o[0]<0?b+o[0]:o[0],h=g<2?b-a:o[1],f=Math.max(g-2,0),l=Reflect.apply(r.splice,r,o),b=r.length;for(let o,n=0;n<b;n++)(o=r[n])&&"object"==typeof o&&((s=t.get(e.get(o)))?s.ownKey=n:console.error("failed to resolve proxy -> target -> observed"));for(let r,o,n=0,s=l.length;n<s;n++)r=l[n],(o=e.get(r))&&(t.get(o).revoke(),l[n]=o);if(y.length){let e,t,o=u.getPath();for(e=0;e<h;e++)(t=o.slice(0)).push(a+e),e<f?c.push({type:"update",path:t,value:r[a+e],oldValue:l[e]}):c.push({type:"delete",path:t,oldValue:l[e]});for(;e<f;e++)(t=o.slice(0)).push(a+e),c.push({type:"insert",path:t,value:r[a+e]});i(y,c)}return l}};export default p;function n(e){return e&&"object"==typeof e&&!r.hasOwnProperty(e.constructor.name)}function l(e,t){return o.hasOwnProperty(t)?o[t].bind(void 0,e):e[t]}function s(r,o){let n=r[o],l=t.get(r);if(delete r[o]){if(n){let r=e.get(n);r&&(t.get(r).revoke(),n=r)}let r=l.getListeners();if(r.length){let e=l.getPath();e.push(o),i(r,[{type:"delete",path:e,oldValue:n}])}return!0}return!1}function i(e,t){let r=e.length;for(;r--;)try{e[r](t)}catch(e){console.error(e)}}function p(r){this.ownKey=r.ownKey,this.parent=r.parent;let o,n=r.target;if(Array.isArray(n)){let e=0,t=n.length;for(o=new Array(t);e<t;e++)o[e]=n[e];this.processArraySubgraph(o),this.revokable=Proxy.revocable(o,{set:this.proxiedSet.bind(this),get:l,deleteProperty:s})}else o=Object.assign({},n),this.processObjectSubgraph(o),this.revokable=Proxy.revocable(o,{set:this.proxiedSet.bind(this),deleteProperty:s});this.observe=function(e){if(this.isRevoked)throw new TypeError("revoked Observable MAY NOT be observed anymore");if("function"!=typeof e)throw new Error("observer (callback) parameter MUST be a function");this.callbacks.indexOf(e)<0?this.callbacks.push(e):console.info("observer (callback) may be bound to an observable only once")},this.unobserve=function(){if(this.isRevoked)throw new TypeError("revoked Observable MAY NOT be unobserved anymore");let e=arguments.length;if(e)for(;e--;){let t=this.callbacks.indexOf(arguments[e]);t>=0&&this.callbacks.splice(t,1)}else this.callbacks.splice(0)},null===this.parent&&(this.isRevoked=!1,this.callbacks=[],Object.defineProperties(o,{revoke:{value:this.revoke.bind(this)},observe:{value:this.observe.bind(this)},unobserve:{value:this.unobserve.bind(this)}})),this.proxy=this.revokable.proxy,t.set(o,this),e.set(this.proxy,o)}p.prototype.processObjectSubgraph=function(e){let t,r,o=Object.keys(e),l=o.length;for(;l--;)n(r=e[t=o[l]])&&(e[t]=new p({target:r,ownKey:t,parent:this}).proxy)},p.prototype.processArraySubgraph=function(e){let t,r=0,o=e.length;for(;r<o;r++)n(t=e[r])&&(e[r]=new p({target:t,ownKey:r,parent:this}).proxy)},p.prototype.getPath=function(){let e=[],t=[],r=0,o=0,n=this;for(;null!==n.ownKey;)e[r++]=n.ownKey,n=n.parent;for(;r--;)t[o++]=e[r];return t},p.prototype.getListeners=function(){let e=this;for(;e;){if(e.callbacks)return e.callbacks;e=e.parent}return[]},p.prototype.revoke=function(){let r=e.get(this.proxy),o=Object.keys(r),n=o.length;for(this.revokable.revoke();n--;){let l=o[n],s=e.get(r[l]);s&&(r[l]=t.get(s).revoke())}return e.delete(this.proxy),t.delete(r),r},p.prototype.proxiedSet=function(r,o,l){let s=r[o];if(n(l)?r[o]=new p({target:l,ownKey:o,parent:this}).proxy:r[o]=l,s){let r=e.get(s);r&&(t.get(r).revoke(),s=r)}let a=this.getListeners();if(a.length){let e=this.getPath();e.push(o),i(a,void 0!==s?[{type:"update",path:e,value:l,oldValue:s}]:[{type:"insert",path:e,value:l}])}return!0},Object.defineProperty(p,"from",{value:function(e){if(!(!n(e)||"observe"in e||"unobserve"in e||"revoke"in e)){return new p({target:e,ownKey:null,parent:null}).proxy}if(!e||"object"!=typeof e)throw new Error("observable MAY ONLY be created from non-null object only");if("observe"in e||"unobserve"in e||"revoke"in e)throw new Error('target object MUST NOT have nor own neither inherited properties from the following list: "observe", "unobserve", "revoke"');if(!n(e))throw new Error(e+" found to be one of non-observable object types: "+r)}}),Object.freeze(p);